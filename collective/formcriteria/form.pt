<metal:block use-macro="here/global_defines/macros/defines" />

<tal:comment content="nothing">
  Copied from CMFPlone/skins/plone_forms/search_form.pt
</tal:comment>
<form action="."
      class="enableAutoFocus"
      method="get"
      name="formcriteria_search"
      id="formcriteria_search"
      tal:attributes="action view/name|template/getId;"
      tal:define="errors options/state/getErrors|python:{}"
      tal:condition="view/formCriteria">

  <fieldset>

    <legend i18n:translate="legend_search_terms">Search Terms</legend>
    <dl>

      <tal:criteria tal:repeat="criterion view/formCriteria">
        <dt>
          
          <div class="field"
	       tal:define="index python:here.portal_atct.getIndex(criterion.Field());">
 	    <label
	       tal:content="python:index.friendlyName or index.index"
	       tal:attributes="for criterion/Field;"
	       i18n:translate="">
	      Label
	    </label>
	    <div class="formHelp" tal:content="index/description"
	         i18n:translate="">
	      Help
	    </div>
          </div>
        </dt>
        
        <tal:comment content="nothing">
          Copied from ATContentTypes/skins/ATContentTypes/atct_macros.pt
        </tal:comment>
        
        <tal:fields 
           define="schematas criterion/Schemata;
                   fieldsets python:[key for key in schematas.keys() if key != 'metadata'];
                   default_fieldset python:(not schematas or schematas.has_key('default')) and 'default' or fieldsets[0];
                   fieldset request/fieldset|options/fieldset|default_fieldset;"
           repeat="field python: schematas[fieldset].fields()">
          <dd tal:define="fieldName string:${criterion/getId}.${field/getName};"
              tal:condition="python:field.mode != 'r'">
            <metal:fieldMacro
               use-macro="python:criterion.widget(fieldName, field=field, mode='edit')" />
          </dd>
        </tal:fields>
      </tal:criteria>
    </dl>

    <div class="visualClear" id="clear-space-before-submit"><!-- --></div>

    <div class="formControls">
      <input class="context"
	     type="submit"
	     name="submit"
	     value="Search"
	     i18n:attributes="value label_search;"
	     />
    </div>

  </fieldset>

</form>
